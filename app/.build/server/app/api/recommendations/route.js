"use strict";(()=>{var e={};e.id=503,e.ids=[503],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},38457:(e,t,i)=>{i.r(t),i.d(t,{originalPathname:()=>w,patchFetch:()=>b,requestAsyncStorage:()=>h,routeModule:()=>g,serverHooks:()=>f,staticGenerationAsyncStorage:()=>y});var o={};i.r(o),i.d(o,{GET:()=>p});var n=i(79182),r=i(72007),a=i(56719),s=i(93442),d=i(15649),u=i(11826),l=i(53524);let c=globalThis.prisma??new l.PrismaClient({log:["query"]});async function p(e){try{let e=await (0,d.getServerSession)(u.L);if(!e?.user)return s.NextResponse.json({error:"Unauthorized"},{status:401});let t=e.user?.id,i=await c.user.findUnique({where:{id:t},include:{weddingDetails:!0}});if(!i?.weddingDetails?.weddingLocation)return s.NextResponse.json({success:!1,error:"Please complete your wedding questionnaire first",needs_questionnaire:!0});let o=i.weddingDetails,n=await m(o);return s.NextResponse.json({success:!0,recommendations:n,user_preferences:{location:o.weddingLocation,guest_count:parseInt(o.guestCount?.split("-")[0]||"50"),budget:Number(o.budget)||0,date:o.weddingDate?.toISOString()||new Date().toISOString(),style:o.weddingStyle||"",priorities:[]}})}catch(e){return console.error("Error generating recommendations:",e),s.NextResponse.json({error:"Failed to generate recommendations"},{status:500})}}async function m(e){try{let t=`
You are an expert wedding planner creating personalized recommendations for a couple. Based on their preferences, provide 4-6 specific, actionable recommendations.

Wedding Details:
- Location: ${e.weddingLocation}
- Date: ${e.weddingDate?new Date(e.weddingDate).toLocaleDateString():"Not specified"}
- Guest Count: ${e.guestCount||"Not specified"}
- Budget: \xa3${e.budget?.toString()||"Not specified"}
- Cultural Traditions: ${e.culturalTraditions?.join(", ")||"None specified"}
- Religious Traditions: ${e.religiousTraditions?.join(", ")||"None specified"}
- Planned Events: ${e.plannedEvents?.join(", ")||"Not specified"}
- Wedding Style: ${e.weddingStyle||"Not specified"}
- Special Requirements: ${e.specialRequirements||"None specified"}

Please provide recommendations in the following JSON format:
{
  "recommendations": [
    {
      "priority": "high|medium|low",
      "category": "venue|catering|photography|music|flowers|decoration|planning",
      "title": "Clear, actionable recommendation title",
      "description": "Detailed description of what they should do",
      "reasoning": "Why this recommendation makes sense for their specific situation",
      "actionable_steps": ["Specific step 1", "Specific step 2", "Specific step 3"],
      "estimated_cost": "Cost range if applicable",
      "timeframe": "When they should act on this"
    }
  ]
}

Focus on:
1. Their budget constraints
2. Guest count considerations  
3. Location-specific advice
4. Timeline urgency (wedding date)
5. Their stated priorities
6. Cultural/religious requirements

Provide practical, specific advice they can act on immediately. Each recommendation should be tailored to their unique situation.

Respond with raw JSON only. Do not include code blocks, markdown, or any other formatting.
    `,i=await fetch("https://apps.abacus.ai/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${process.env.ABACUSAI_API_KEY}`},body:JSON.stringify({model:"gpt-4o-mini",messages:[{role:"user",content:t}],max_tokens:2e3,response_format:{type:"json_object"}})});if(!i.ok)throw Error(`AI API request failed: ${i.status}`);let o=await i.json(),n=o.choices[0]?.message?.content;if(!n)throw Error("No response from AI service");return JSON.parse(n).recommendations||[]}catch(t){return console.error("AI recommendation generation failed:",t),function(e){let t=[],i=e.weddingDate?new Date(e.weddingDate):null,o=i?Math.max(0,Math.ceil((i.getTime()-Date.now())/2592e6)):12;e.guestCount&&parseInt(e.guestCount.split("-")[0]);let n=Number(e.budget)||0;return t.push({priority:"high",category:"venue",title:"Secure Your Wedding Venue",description:`Find and book your wedding venue in ${e.weddingLocation}. With ${e.guestCount||"your estimated"} guests, you'll need a space that can comfortably accommodate everyone.`,reasoning:"Venue is typically the largest expense and sets the tone for your entire wedding. Popular venues book up quickly, especially in desirable locations.",actionable_steps:["Research venues in your area that fit your budget and guest count","Schedule site visits for your top 3-5 choices","Ask about availability for your wedding date","Compare pricing packages and what's included"],estimated_cost:n?`\xa3${Math.round(.4*n).toLocaleString()} - \xa3${Math.round(.5*n).toLocaleString()}`:"\xa33,000 - \xa315,000",timeframe:o>12?"12-18 months before wedding":"Book immediately"}),t.push({priority:"high",category:"photography",title:"Book Your Wedding Photographer",description:"Secure a professional photographer to capture your special moments. Quality wedding photography is an investment in memories that will last forever.",reasoning:"The best photographers in your area book up quickly, and photography is one element you cannot recreate after the wedding.",actionable_steps:["Research photographers whose style matches your vision","Review full wedding galleries, not just highlight reels","Meet with photographers to ensure personality fit","Compare packages and understand what's included"],estimated_cost:n?`\xa3${Math.round(.1*n).toLocaleString()} - \xa3${Math.round(.15*n).toLocaleString()}`:"\xa31,000 - \xa33,000",timeframe:o>9?"9-12 months before wedding":"Book as soon as possible"}),n&&n<1e4&&t.push({priority:"medium",category:"planning",title:"Maximize Your Budget with Smart Choices",description:"With your budget of \xa3"+n.toLocaleString()+", focus on the elements that matter most to you and find creative ways to save on others.",reasoning:"Strategic planning can help you achieve your dream wedding within your budget constraints.",actionable_steps:["Prioritize your top 3 most important wedding elements","Consider weekday or off-season dates for better pricing","Look into DIY options for decorations and favors","Research local vendors who offer package deals"],estimated_cost:"Stay within existing budget",timeframe:"Start planning immediately"}),o<6&&t.push({priority:"high",category:"planning",title:"Accelerate Your Wedding Planning",description:"With only "+o+" months until your wedding, you need to move quickly on key decisions and bookings.",reasoning:"Many vendors require 6+ months lead time, so you'll need to be flexible and act fast.",actionable_steps:["Book venue and photographer immediately","Be flexible with vendor choices and dates","Consider simplified menu options","Focus on essential elements first"],timeframe:"All actions are urgent"}),(e.culturalTraditions?.length>0||e.religiousTraditions?.length>0)&&t.push({priority:"medium",category:"planning",title:"Honor Your Cultural and Religious Traditions",description:"Incorporate your cultural and religious traditions meaningfully into your wedding celebration.",reasoning:"These elements add personal significance and ensure your wedding reflects your values and heritage.",actionable_steps:["Research vendors experienced with your traditions","Plan ceremony elements that honor your beliefs","Consider traditional music, food, or customs","Communicate requirements clearly to all vendors"],timeframe:"Include in all vendor discussions"}),t.slice(0,5)}(e)}}let g=new n.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/recommendations/route",pathname:"/api/recommendations",filename:"route",bundlePath:"app/api/recommendations/route"},resolvedPagePath:"/home/ubuntu/wedding_planner_platform/app/app/api/recommendations/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:h,staticGenerationAsyncStorage:y,serverHooks:f}=g,w="/api/recommendations/route";function b(){return(0,a.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:y})}},11826:(e,t,i)=>{i.d(t,{L:()=>d});var o=i(66291),n=i(64617),r=i(83178),a=i(3390),s=i.n(a);let d={adapter:(0,n.N)(r._),providers:[(0,o.Z)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let t=await r._.user.findUnique({where:{email:e.email}});return t&&t.password&&await s().compare(e.password,t.password)?{id:t.id,email:t.email,name:t.name,partnerOneName:t.partnerOneName,partnerTwoName:t.partnerTwoName}:null}})],session:{strategy:"jwt"},pages:{signIn:"/auth/signin"},callbacks:{jwt:async({token:e,user:t})=>(t&&(e.partnerOneName=t.partnerOneName,e.partnerTwoName=t.partnerTwoName),e),session:async({session:e,token:t})=>(e?.user&&t?.sub&&(e.user.id=t.sub,e.user.partnerOneName=t.partnerOneName,e.user.partnerTwoName=t.partnerTwoName),e)}}},83178:(e,t,i)=>{i.d(t,{_:()=>n});var o=i(53524);let n=globalThis.prisma??new o.PrismaClient}};var t=require("../../../webpack-runtime.js");t.C(e);var i=e=>t(t.s=e),o=t.X(0,[372,329,3,609],()=>i(38457));module.exports=o})();